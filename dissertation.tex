\documentclass[12pt,oneside]{book}

\usepackage{ifthen}
\newboolean{final}
\setboolean{final}{false}
\newboolean{draft}
\setboolean{draft}{true}

\usepackage[a4paper]{geometry}
\setlength{\marginparwidth}{2.75cm}

\usepackage{subfiles}
\def\biblio{%
  \renewcommand{\emph}{\textit}%
  \bibliographystyle{dissertation}%
  \bibliography{../bib}%
  \printindex%
  \listoftodos}
\def\subfilebiblio{\biblio}
\def\headercorrection{\fancyhfoffset[L]{8pt}\fancyhfoffset[R]{-8pt}}
\def\subfileheadercorrection{\headercorrection}

\usepackage[hidelinks,backref=page]{hyperref}
\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Section}
\renewcommand{\figureautorefname}{Figure}

\usepackage{bookmark}
\usepackage{makeidx}
\renewcommand{\indexname}{Index of global definitions}
\makeindex

\usepackage[square]{natbib}
\newcommand{\varcitet}[2]{\citeauthor{#1}#2~\citeyearpar{#1}}
\newcommand{\bibnamefont}[1]{\textsc{#1}}
\renewcommand*{\backref}[1]{}
\renewcommand*{\backrefalt}[4]{%
  \ifcase #1 \relax%
  \or        {\small$\Lsh$~page~#2}%
  \else      {\small$\Lsh$~pages~#2}%
  \fi}
\urlstyle{tt}
\newcommand{\doi}[1]{doi:~\href{http://dx.doi.org/#1}{\nolinkurl{#1}}}
\newcommand{\isbn}[1]{{\small ISBN}:~\href{http://www.isbnsearch.org/isbn/#1}{\nolinkurl{#1}}}
\newcommand{\urlentry}[1]{{\small URL}:~\url{#1}}
\newcommand{\arXiv}[1]{\href{http://arxiv.org/abs/#1}{arXiv:\nolinkurl{#1}}}

\usepackage{microtype}

\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\textbf{\thechapter}~~~#1}{\textbf{\thechapter}~~~#1}}%
\renewcommand{\sectionmark}[1]{\markright{\textbf{\thesection}~~~#1}}%
\fancyhf{}%
\fancyhead[LE, RO]{\thepage}%
\fancyhead[RE]{\leftmark}%
\fancyhead[LO]{\rightmark}%
\makeatletter
\renewcommand{\tableofcontents}{%
    \hypertarget{tableofcontents}{}\bookmark[dest=tableofcontents]{Contents}%
    \chapter*{\contentsname\markboth{Contents}{Contents}}%
    \thispagestyle{empty}%
    \@starttoc{toc}%
    }
\makeatother
\setlength{\headheight}{14.5pt}
\renewcommand{\MakeUppercase}{\relax}

\usepackage[nottoc]{tocbibind}

\usepackage[labelfont=bf,labelsep=quad,font=small]{caption}
\usepackage{rotating}
\newcommand{\codefigure}{\setlength{\mathindent}{0em}}
\newcommand{\size}[2]{{\fontsize{#1}{0pt}\selectfont #2}}

\usepackage{graphicx}

\usepackage{tikz}
\usetikzlibrary{matrix,arrows,calc,fadings}
\tikzset{every path/.append style={semithick}}
\begin{tikzfadingfrompicture}[name=fade out, x=25bp, y=25bp]
\fill[color=transparent!0] (-1, -.66) rectangle (1, .66);
\shade[top color=transparent!0, bottom color=transparent!100] (-1, -1) rectangle (1, -.65);
\shade[top color=transparent!100, bottom color=transparent!0] (-1, .65) rectangle (1, 1);
\end{tikzfadingfrompicture}
\tikzset{label on arrow/.style={fill=white, path fading=fade out}}
\begin{tikzfadingfrompicture}[name=horizontal fade out, x=25bp, y=25bp]
\fill[color=transparent!0] (-.66 , -1) rectangle (.66 , 1);
\shade[right color=transparent!0, left color=transparent!100] (-1, -1) rectangle (-.65 , 1);
\shade[right color=transparent!100, left color=transparent!0] (.65, -1) rectangle (1, 1);
\end{tikzfadingfrompicture}
\tikzset{horizontal label on arrow/.style={fill=white, path fading=horizontal fade out}}

\usepackage[vskip=0pt]{quoting}

% by Paul Taylor
\def\qed {{%        set up
   \parfillskip=0pt        % so \par doesnt push \qedsymbol to left
   \widowpenalty=10000     % so we dont break the page before \qedsymbol
   \displaywidowpenalty=10000  % ditto
   \finalhyphendemerits=0  % TeXbook exercise 14.32
  %
  %                 horizontal
   \leavevmode             % \nobreak means lines not pages
   \unskip                 % remove previous space or glue
   \nobreak                % donâ€™t break lines
   \hfil                   % ragged right if we spill over
   \penalty50              % discouragement to do so
   \hskip.2em              % ensure some space
   \null                   % anchor following \hfill
   \hfill                  % push \qedsymbol to right
   \qedsymbol\kern-.6pt%   % the end-of-proof mark
  %
  %                 vertical
   \par}}                  % build paragraph
\def\qedsymbol{$\Box$}
\makeatletter
\def\block{\@ifstar\@block\@@block}
\newcommand{\@block}[2]{\noindent\textbf{#1.}\hskip1em #2\qed}
\newcommand{\@@block}[3]{\noindent\textbf{#1}~(\nobreak\hskip.05em\nobreak\textit{#2}\nobreak\hskip.05em\nobreak)\textbf.\hskip1em #3\qed}
\makeatother

\usepackage{enumitem}
\setitemize{leftmargin=*,labelindent=0em,itemsep=.6\parskip,topsep=-.4\parskip,parsep=0pt,partopsep=0pt}

\hyphenation{pa-ra-me-trise}
\hyphenation{pa-ra-me-trised}
\hyphenation{pa-ra-me-tri-sa-tion}
\hyphenation{da-ta-type}
\hyphenation{da-ta-types}
\hyphenation{light-weight}

\newcommand{\omission}{{\small[\ldots\!]}}

\newcommand{\name}{\textsc}
\newcommand{\Agda}{\name{Agda}}

\newcommand{\sidenote}[1]{{\color[gray]{.45}(#1)}}

\usepackage{bussproofs}
\EnableBpAbbreviations

\usepackage{soul}
\setul{1.2pt}{.5pt}
\renewcommand{\emph}{\ul}
\newcommand{\key}{\textbf}

%\usepackage{mathtools}
%\newtagform{bold}[\textbf]{(}{)}
%\usetagform{bold}

\ifthenelse{\boolean{final}}{%

  \newcommand{\timestamp}{Hilary 2014}%

  \usepackage[disable]{todonotes}%

}{ %else \boolean{final}

  \usepackage{datetime}%
  \usepackage[UKenglish]{isodate}%
  \cleanlookdateon%

  \ifthenelse{\boolean{draft}}{%

    \newcommand{\timestamp}{Draft compiled at \currenttime, \today}%

    \usepackage[color=yellow,textsize=footnotesize]{todonotes}%

  }{% else \boolean{draft}

    \newcommand{\timestamp}{\today}%

    \usepackage[disable]{todonotes}%

  }

}

\usepackage{amsmath}
\usepackage[sc]{mathpazo}
\linespread{1.2}
\usepackage{rsfso}
\newcommand{\keyword}{\mathbf}
\newcommand{\constructor}{\mathsf}
\newcommand{\identifier}{\mathit}
\newcommand{\proofterm}[1]{{\color{gray}#1}}
\newcommand{\rel}[1]{\kern-.1em\mathrel{#1}\kern-.1em}
\newlength{\underscorespace}
\setlength{\underscorespace}{.8pt}
\newcommand{\binderbracketl}{[}
\newcommand{\binderbracketr}{]}
\newlength{\binderspace}
\setlength{\binderspace}{.075em}
\newlength{\binderskip}
\setlength{\binderskip}{.2em plus .2em minus .1em}
\newlength{\mathindent}
\setlength{\mathindent}{.5\parindent}
\makeatletter
\g@addto@macro\normalsize{%
  \setlength{\parskip}{.4\baselineskip}
  \setlength{\abovedisplayskip}{\medskipamount}
  \setlength{\belowdisplayskip}{\abovedisplayskip}
}
\newcommand{\shorteq}{%
  \settowidth{\@tempdima}{--}%
  \resizebox{\@tempdima}{\height}{=}%
}
\newcommand{\@highlight}[2]{\smash{\text{\colorbox[gray]{#2}{\kern-.1em\vphantom{\vrule height 1.4ex depth 0.3ex}\smash{\ensuremath{#1}}\kern-.1em}}}}
\newcommand{\highlight}[1]{\@highlight{#1}{.85}}
\newcommand{\Highlight}[1]{\@highlight{#1}{.70}}
\makeatother
\DeclareSymbolFont{euler}{U}{eur}{m}{n}
\DeclareMathSymbol{\upsigma}{\mathalpha}{euler}{"1B}
\newcommand{\recordmember}{\kern.08em.\kern.08em}
\newcommand{\reason}[1]{\quad\{\,\text{#1}\,\}}
\newcommand{\categorical}[2]{\mathbb{#1}\textsc{#2}}
\input{processed-agda-preamble}

\begin{document}

\def\subfilebiblio{}
\def\subfileheadercorrection{}

\frontmatter

\subfile{titlepage}

\newgeometry{top=3.5cm}
\subfile{abstract}
\cleardoublepage
\restoregeometry

%\subfile{acknowledgements}
%\cleardoublepage

\tableofcontents

\mainmatter

\subfile{processed-chapter1}
\subfile{processed-chapter2}
\subfile{processed-chapter3}
\subfile{processed-chapter4}
\subfile{processed-chapter5}
\subfile{processed-chapter6}
\subfile{processed-chapter7}

\backmatter

\biblio

\end{document}
